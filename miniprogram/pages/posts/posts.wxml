<!-- posts.wxml -->
<view class="container">
  <!-- 检索栏 -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <image 
        class="search-icon" 
        src="../../assets/search/search_icon.png"
        bindtap="onSearch"
      />
      <input 
        class="search-input" 
        type="text" 
        placeholder="搜搜感兴趣的帖子吧" 
        bindinput="onSearchInput"
      />
    </view>
  </view>

  <!-- 帖子列表 -->
  <view class="post-list">
    <block wx:for="{{posts}}" wx:key="_id">
      <view class="post-item">
        <view class="post-header">
          <view class="author-info" bindtap="navigateToUserProfile" data-userid="{{item.author._id}}">
            <image class="author-avatar" src="{{item.author.avatar_url}}" mode="aspectFill"/>
            <view class="author-detail">
              <text class="author-name">{{item.author.nickname}}</text>
              <text class="author-bio">{{item.author.bio}}</text>
            </view>
          </view>
          <text class="post-time">{{item.create_time}}</text>
        </view>
        <view class="post-body" bindtap="goToContent" data-postid="{{item._id}}">
          <!-- <text class="post-title">{{item.title}}</text>
          <view class="divider"></view> -->
          <text class="post-content">{{item.content}}</text>
        </view>
        <view class="post-footer">
          <view class="post-stats-wrapper">
            <view class="post-stats">

              <view class="stat-item">
                <image class="stat-icon" src="../../assets/posts/view_icon0.png" mode="aspectFit"/>
                <text class="stat-count">{{item.view_count || 0}}</text>
              </view>

              <view class="stat-item">
                <!-- like按钮 -->
                <image 
                  class="stat-icon" 
                  src="{{item.liked ? '../../assets/posts/like_icon1.png' : '../../assets/posts/like_icon0.png'}}" 
                  mode="aspectFit"
                  bindtap="onLike"
                  data-postid="{{item._id}}"
                  data-index="{{index}}"
                />
                <text class="stat-count">{{item.like_count || 0}}</text>
              </view>

              <view 
                class="stat-item" 
                bindtap="goToContent" 
                data-postid="{{item._id}}"
                data-index="{{index}}"
               >
                <image class="stat-icon" src="../../assets/posts/comment_icon0.png" mode="aspectFit"/>
                <text class="stat-count">{{item.comment_count || 0}}</text>
              </view>
              <!--
              <view class="stat-item">
                <image class="stat-icon" src="../../assets/posts/share_icon.png" mode="aspectFit"/>
              </view>
              -->
            </view>
          </view>
        </view>
      </view>
    </block>
  </view>
  
  <!-- 加载中提示 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>
  
  <!-- 没有更多数据提示 -->
  <view class="no-more" wx:if="{{!hasMore && posts.length > 0}}">
    <text>没有更多帖子了</text>
  </view>
  
  <!-- 空状态提示 -->
  <view class="empty" wx:if="{{!loading && posts.length === 0}}">
    <text>还没有帖子，快来发布第一条吧！</text>
  </view>
</view>